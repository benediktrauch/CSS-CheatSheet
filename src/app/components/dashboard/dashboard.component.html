<div class="container">

  <!--<button mat-raised-button color="primary">Click me!</button>-->

  <ng-container *ngIf="isLoggedIn()">
    <a mat-stroked-button color="primary" (click)="toggleEditMode()" href="dashboard#newSnippet" *ngIf="!editMode">
      Add new</a>
  </ng-container>

  <ng-container id="newSnippet" #newSnippet></ng-container>
  <ng-container class="snippet mdc-elevation--z4" *ngIf="editMode">
    <csscs-edit-snippet (cancelEdit)="cancelEditMode()" (submitEdit)="addOrUpdateSnippet($event)"
                        [snippet]="editSnippet"></csscs-edit-snippet>
  </ng-container>

  <ng-container *ngIf="searchString
  && searchString.length > 1
  && (($codeSnippets | async) | csscsFilter : searchString).length < 1"
       class="mdc-elevation--z4 snippet">
    <h1>No snippets found for: {{searchString}}</h1>
    <button mat-stroked-button color="primary" (click)="setSearchString('')">
      <mat-icon>done</mat-icon>
      <span>Okay, show all</span>
    </button>
  </ng-container>

  <div class="loadingAnimation" *ngIf="!($codeSnippets | async)">
    <mat-icon aria-hidden="false" aria-label="Download">cloud_download</mat-icon>
    <mat-progress-spinner
      class="spinner"
      [color]="'primary'"
      [diameter]="300"
      [strokeWidth]="3"
      [mode]="'indeterminate'">
    </mat-progress-spinner>
  </div>

  <div *ngFor="let snippet of ($codeSnippets | async) | csscsFilter : searchString; index as index; trackBy: identify"
       [ngClass]="{'snippet': true, 'mdc-elevation--z4': true, 'deleteMode': selectedSnippet === index}">
    <div class="block">
      <div class="header">
        <h1>{{snippet.title}}</h1>
        <div *ngIf="isLoggedIn()">
          <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="snippetEdit(snippet)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item (click)="confirmDelete(index)">
              <mat-icon>delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </div>
      </div>
      <div class="main">
        <p>{{snippet.desc}}</p>
      </div>
      <div class="code">
        <div class="result">
          <div [ngClass]="{'snippetWrapper':true, 'nightMode': darkMode, 'mdc-elevation--z8': !darkMode}">
            <csscs-snippet [snippet]="snippet"></csscs-snippet>
          </div>
        </div>
      </div>
      <div class="footer" *ngIf="snippet.tags && snippet.tags[0] && snippet.tags[0].name">
        <a class="snippetTags" *ngFor="let tag of snippet.tags" [routerLink]="['/']" [queryParams]="{search: tag.name}">
          #{{tag.name}}
        </a>
      </div>
    </div>
    <div class="block source">
      <csscs-source [snippet]="snippet"></csscs-source>
    </div>
    <div class="deleteConfirmation">
      <ng-container class="confirmationWrapper" *ngIf="!deletingSnippet">
        <span>Do you really want to delete this snippet?</span>

        <div class="buttonBar">
          <button mat-flat-button color="warn" type="button" (click)="snippetDelete(snippet)">
            <mat-icon>delete</mat-icon>
            <span>Yes, delete this snippet</span>
          </button>

          <button mat-stroked-button color="primary" type="button" (click)="cancelDeleteMode()">
            <mat-icon>cancel</mat-icon>
            <span>Cancel</span>
          </button>
        </div>
      </ng-container>
      <ng-container class="deleteAnimation" *ngIf="deletingSnippet">
        <mat-icon aria-hidden="false" aria-label="delete">delete</mat-icon>
        <mat-progress-spinner
          class="spinner"
          [color]="'primary'"
          [diameter]="300"
          [strokeWidth]="3"
          [mode]="'indeterminate'">
        </mat-progress-spinner>
      </ng-container>
    </div>
  </div>
  <div class="darkmodeFab">
    <button mat-fab color="primary" (click)="toggleDarkMode()" aria-label="color toggle button">
      <mat-icon>{{darkMode ? 'brightness_high' : 'brightness_low'}}</mat-icon>
    </button>
  </div>

</div>
